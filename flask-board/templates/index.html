<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>게시판</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', Arial, sans-serif; margin: 0; background:#f7f7f8; color:#111; }
        .container { max-width: 760px; margin: 40px auto; padding: 0 16px; }
        header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 16px; }
        a.button { background:#111; color:#fff; padding:10px 14px; border-radius: 8px; text-decoration:none; }
        .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; margin-bottom:12px; }
        .title { font-weight:600; font-size:18px; margin:0 0 6px; }
        .meta { color:#6b7280; font-size:12px; margin-bottom: 8px; }
        .content { white-space: pre-wrap; line-height:1.6; }
        form.inline { display:inline; }
        button.danger { background:#ef4444; color:#fff; border:none; padding:6px 10px; border-radius:8px; cursor:pointer; }
    </style>
    <script>
        function confirmDelete(id){ if(confirm('정말 삭제할까요?')){ document.getElementById('del-'+id).submit(); } }
    </script>
    </head>
<body>
    <div class="container">
        <header>
            <h1>📋 게시판</h1>
            <div>
                {% if current_user %}
                    <span style="margin-right:8px;">안녕하세요, {{ current_user.username }}님 ({{ current_user.role }})</span>
                    <a class="button" href="/write">글쓰기</a>
                    <a class="button" style="background:#6b7280; margin-left:6px;" href="/logout">로그아웃</a>
                {% else %}
                    <a class="button" href="/login">로그인</a>
                    <a class="button" style="background:#6b7280; margin-left:6px;" href="/register">회원가입</a>
                {% endif %}
            </div>
        </header>

        {% for p in posts %}
            <div class="card">
                <h2 class="title">{{ p.title if p.title is defined else p[1] }}</h2>
                <div class="meta">
                    작성자: {{ (p.author if p.author is defined else p[3]) or '익명' }} · 
                    {{ (p.created_at if p.created_at is defined else p[4]) }}
                </div>
                <div class="content">{{ p.content if p.content is defined else p[2] }}</div>
                {% if current_user and (current_user.role == 'admin' or current_user.username == (p.author if p.author is defined else p[3])) %}
                <div style="margin-top:8px;">
                    <form id="del-{{ p.id if p.id is defined else p[0] }}" class="inline" method="post" action="/delete/{{ p.id if p.id is defined else p[0] }}">
                        <button type="button" class="danger" onclick="confirmDelete('{{ p.id if p.id is defined else p[0] }}')">삭제</button>
                    </form>
                </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
</body>
</html>
