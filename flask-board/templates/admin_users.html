<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', Arial, sans-serif; margin: 0; background:#f7f7f8; color:#111; }
        .container { max-width: 960px; margin: 40px auto; padding: 0 16px; }
        header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 16px; }
        a.button, button { background:#111; color:#fff; padding:10px 14px; border-radius: 8px; text-decoration:none; border:none; cursor:pointer; font-size:14px; }
        button.danger { background:#ef4444; }
        button.secondary { background:#6b7280; }
        .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:20px; margin-bottom:16px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #e5e7eb; vertical-align: middle; }
        th { background-color: #f9fafb; }
        .actions form { display: inline-flex; gap: 6px; align-items: center; }
        select, input { padding: 6px 8px; border-radius: 6px; border: 1px solid #e5e7eb; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; align-items: flex-end; }
        .flashes { list-style: none; padding: 0; margin: 0 0 16px 0; }
        .flashes li { padding: 12px 16px; border-radius: 8px; margin-bottom: 8px; }
        .flashes .success { background-color: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .flashes .danger { background-color: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
    </style>
    <script>
        function handleConfirmation(formId, message) {
            if (confirm(message)) {
                document.getElementById(formId).submit();
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h1>
            <div>
                <a class="button" href="/">Í≤åÏãúÌåêÏúºÎ°ú</a>
            </div>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <div class="card">
            <h2>ÏÉà ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä</h2>
            <form method="post" action="/admin/users/add" class="form-grid">
                <div>
                    <label for="username">ÏïÑÏù¥Îîî</label>
                    <input id="username" type="text" name="username" required />
                </div>
                <div>
                    <label for="password">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input id="password" type="password" name="password" required />
                </div>
                <div>
                    <label for="role">Ïó≠Ìï†</label>
                    <select id="role" name="role">
                        <option value="user" selected>User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button type="submit">Ï∂îÍ∞Ä</button>
            </form>
        </div>

        <div class="card">
            <h2>ÏÇ¨Ïö©Ïûê Î™©Î°ù</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Created At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.role }}</td>
                        <td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td class="actions">
                            <!-- Role Edit Form -->
                            <form method="post" id="edit-role-{{ user.id }}" action="/admin/users/edit_role/{{ user.id }}">
                                <select name="role" onchange="this.form.submit()" {% if current_user.id == user.id %}disabled{% endif %}>
                                    <option value="user" {% if user.role == 'user' %}selected{% endif %}>User</option>
                                    <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
                                </select>
                            </form>
                            <!-- Password Reset Form -->
                            <form method="post" id="reset-pw-{{ user.id }}" action="/admin/users/reset_password/{{ user.id }}">
                                <button type="button" class="secondary" onclick="handleConfirmation('reset-pw-{{ user.id }}', 'ÏÇ¨Ïö©Ïûê {{ user.username }}Ïùò ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')">PW Ï¥àÍ∏∞Ìôî</button>
                            </form>
                            <!-- Delete User Form -->
                            <form method="post" id="delete-user-{{ user.id }}" action="/admin/users/delete/{{ user.id }}">
                                <button type="button" class="danger" {% if current_user.id == user.id %}disabled{% endif %} onclick="handleConfirmation('delete-user-{{ user.id }}', 'ÏÇ¨Ïö©Ïûê {{ user.username }}ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')">ÏÇ≠Ï†ú</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>